<html>
  <head>
  <title>Project: an end-to-end loan funding predictor for kiva.org</title>
  <!--script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script-->
  <!--script src="http://d3js.org/d3.v3.js" charset="utf-8"></script-->
  <!--script src="nv.d3.min.js" charset="utf-8"></script)-->

  <script src="d3.v3.min.js" charset="utf-8"></script>
  <link rel="stylesheet" type="text/css" href="visualizer.css" />
  <script src="http://code.jquery.com/jquery-1.11.2.min.js" charset="utf-8"></script>
  <script type="text/javascript" src="jquery.lettering-0.6.1.min.js"></script>
  <script type="text/javascript" src="career_center.js"></script>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0" />
  <script src="sankey.js" charset="utf-8"></script>
  <script src="loanflow_visualizer.js" charset="utf-8"></script>

  </head>

  <body>

    <h2>No time? Here's the short story</h2>

    <iframe src="//www.slideshare.net/slideshow/embed_code/46767328" width="476" height="400" frameborder="1" marginwidth="0" marginheight="0" scrolling="no"></iframe>

    <h2>Introduction</h2>

    <p>My <a href="/projects/kiva-topic-modelling-project/"
      target="_">previous blog post</a> offered a high-level glance  
      into the loan descriptions at <a href="http://kiva.org/" target="_">kiva.org</a>.
      For my final project at
      the <a href="http://www.thisismetis.com/data-science"
      target="_">Metis Data Science Bootcamp</a>, 
      I delved a bit deeper in the micro-finance mechanics at Kiva,
      looking for a practical problem to solve.
      Earlier <a href="#kiva_research">research papers on Kiva</a>
      have studied for example how images of Kiva borrowers
      influence loan decisions by lenders <a href="#jenq_pan_theseira">[1]</a>,
      or which factors motivate
      lenders to make additional
      loans <a href="#Choo_Lee_Lee_Zha_Park">[2]</a>. My high-level
      aim in this project was double: produce <b>new insights</b>, and, above all, build
      something <b>ready to use and demo</b> &mdash; all in the course of
      four weeks.
    </p>

    <p>Let's start by setting the stage.</p>

    <h3>The micro-finance process at Kiva.org</h3>

    <p>
      The abovementioned paper <a href="#Choo_Lee_Lee_Zha_Park">[2]</a> contains a clear overview of
      the <a href="http://www.kiva.org/about/how/even-more"
      target="_">Kiva loan process</a>. It is repeated here below, but with
      a couple of additions (two ovals and one curved arrow) to point
      out some particulars that drew my attention:</p>

    
      <ul>
	<li>Field partners actually <b>pre</b>disburse loans to
	borrowers <b>before</b> they are published to lenders
	on the Kiva website. This obviously involves a certain risk.</li>
	<li>So, when (typically an ad hoc group of) lenders allocate their money to a
	loan, they are actually <b>back-filling a 
	predisbursed loan</b>. Only when a loan is fully backfilled
	does the loan default <b>risk 
	move from the field partner to the lenders</b>.</li>
      </ul>
      
      <figure>
	<img src="/images/kiva_loan_process.png"></img>
	<figcaption>Augmented overview of the Kiva loan process
	(adapted from [<a href="#Choo_Lee_Lee_Zha_Park">2</a>])</figcaption>
      </figure>

    <p>The crucial point, of course, is whether <b>enough</b> lenders will be
    found <b>within a loan request's expiration time</b> to back-fill the
    loan.
      When a loan is not completely funded
    in time, the allocated amounts return to the Kiva lenders, and the full
    risk stays with the field partner. The predisbursed loan itself,
    however, remains: the borrower already received the money, and is expected to
    pay it back over time.</p>

    <p>Getting loans fully funded is in the interest of multiple
    parties:
      <ul>
	<li>Even though <b>field partners</b> must have some capital of their own,
	they want to limit their overall risk by having the worldwide
	Kiva lender community maximally back-fill the predisbursed loans.</li>
	<li>Kiva <b>lenders</b> &mdash; who are benevolent by definition &mdash; want to
	see their available capital used, rather than stay
	dormant in the system.</li>
	<li><b>Borrowers</b> will have an easier time getting loans
	predisbursed as the fields partners are more confident that
	they will be backfilled in time.</li>
      </ul>
    </p>

    <p><b>Efficient loan funding is therefore beneficial to the Kiva
    ecosystem as a whole</b>. This is especially true in times when the total amount of
    loan requests exceeds the available money in the system.</p>

    <p>By the way,
    Kiva loans being interest free, there is no other built-in
    mechanism for steering offer and demand, than trust, benevolence
    and advertizing &mdash;  whether by word of mouth or otherwise.</p>

    <h3>The downside of Kiva's growth: non-backfilled loans</h3>

    <p>In terms of growth, Kiva has been a phenomenal success. Since
    its start in 2005, the number of loan requests has risen year after year. In the
    early years, there seems to have been enough available money in the
    system to fully backfill most, if not all loan requests. However, <b>since
    2012, a significant number of predisbursed loans do not get
    backfilled</b>, as is illustrated below.</p>

    <figure>
      <img src="/images/nr_loans_per_quarter.png" style="margin-top:20px; margin-bottom:20px;"/>
      <figcaption>Per-quarter bar chart of loan requests in period 2006-2014</figcaption>
    </figure>

    <p>The rising number of non-backfilled loans since 2012 may be due to the
    relative lack of fresh inflowing capital from Kiva lenders, and/or to
    an intrinsic deterioration of loan quality. Whichever the reason,
    it is unknown if, to what extent and how soon the rising proportion of
    non-backfilled loans has translated into a growing reticence for
      field partners to predisburse loans in the
      first place: no data are currently available to test either of these
    hypotheses. But from the 
      field partners' perspective, <b>there must
      be an inherent limit to increase their
      own capital and incur more risk</b>. In a system with acceptable
    risk-taking, any transgression of this limit must
      eventually <b>hamper the (invisible) predisbursal rate of initial loan
      requests, <em>including valid ones</em></b>.</p>

    <p>Especially male borrowers are lagging behind. Not
    only have they historically entered the Kiva system less
    frequently than females; 
    but since 2012,
    loans to male borrowers have proportionally had a harder time
    getting backfilled 
    than loans predisbursed to females.</p>

    <p><b>Irrespective of the amount of money present in the
    Kiva ecosystem at any moment, we should at least try to make the
    available funds flow as efficiently as possible</b>.</p> 

    <h3>Kiva micro-finance is big</h3>

    <p>As a final introductory note, let's
    visualize <a href="sankey.html" target="_">how money 
    flows through the global Kiva ecosystem</a>. The interactive
    <a href="http://en.wikipedia.org/wiki/Sankey_diagram" target="_">Sankey diagram</a>
    below summarizes, for the period 2012 through 2014, the
    money flows between lenders and borrowers. In these three years,
    more than <b>321 million dollars</b> have been lent &mdash; and then
    (hopefully) repaid.</p>
    <p> The connections in the center &quot;column&quot; shows the
    country-to-country money flows. The left and right column do not
    really represent flows; they rather group the countries by region,
    respectively from the lenders' and the borrowers' perspective.</p>

    <p>To see the dollar amounts, simply hover with the mouse over the
    graph. After a second or two, a popup will appear.</p>
      
    <div id="sankey_container" style="margin-top:20px; margin-bottom:40px; border-width:0px;border-style:solid;border-color:black;">

    <h4 style="margin-top:20px; margin-bottom:20px;"
    align="center">Kiva microloans, grouped per region and country<br/>
    (2012-2014, combined)</h4>

    <div id="heading">
      <div class="header" id="lending_region">Lending Regions</div>
      <div class="header" id="lending_country">Lending Countries</div>
      <div class="header" id="borrowing_country">Borrowing Countries</div>
      <div class="header" id="borrowing_region">Borrowing Regions</div>
    </div>
    <div id="loanFlowChart"></div>
    <div style="float:left; text-align:left;"><small>[This <a href="http://d3js.org/"
    target="_blank">D3</a> <a href="http://bost.ocks.org/mike/sankey/"
    target="_blank">Sankey Diagram</a> is inspired
    by <a href="https://apps.carleton.edu/career/visualize/"
    target="_blank">Carleton College Career Path]</a></small></div>

    <div style="float:right; text-align:right;"><small>[<a href="sankey.html"
    target="_blank">Open in separate window</a>]</small></div>

    </div><!-- sankey_container -->

    <p style="clear:both">
    All figures are calculated from
    a <a href="http://build.kiva.org/" target="_">Kiva JSON data
    snapshot</a> downloaded on February 17, 2015. The software code
    is available on <a href="https://github.com/fdurant/kiva_project/tree/master/d3" target="_">GitHub</a>.</p> 

    <p>Now that the stage is set, let's define our problem more precisely.</p>

    <h2>Business goal: optimal money flow, by predicting the funding
    of new loan requests</h2>

    <p>
    The <b>business goal</b> in this project is to <b>reduce the amount of
    non-productive, sleeping
    money in the system</b>.</p>

    <p>The main observation is that <b>it is
    better for X% of loans to be 100% funded, than for 100% of loans
    to be funded at X% each.</b> In the latter (granted, somewhat
    extreme) case, following Kiva policy, all funds would simply
    return to the lenders. This means that not a single loan would be backfilled!</p>

    <p>
    To reach this business goal, I propose a tool that
    provides an <b>a priori insight into the chance of a loan request
    being fully funded</b> by available Kiva lender money. Next to
    that, this study aims to uncover <b>actionable insights</b> to the
    concerned parties, who may benefit as follows:</p>

    <ul>
      <li>Field partners and borrowers can work together to <b>adapt certain
	characteristics of a loan request</b> in order to increase its
	chance of being funded.</li>
      <li>Field partners and/or the Kiva platform can <b>promote certain
      loan requests</b>, in the interest of system
      efficiency. This way they can avoid or mitigate the &quot;many
      loans <em>almost</em> funded&quot; trap.</li>
      <li>Lenders may want to know up-front if their money is going
      to <b>fund a &quot;winning&quot; loan request</b>, and adapt their
      decisions accordingly.</li>
    </ul>

    </p>

      <p><b>Disclaimer</b>:
    I am fully aware that each of these uses are <b>possibly
    controversial</b>. They might indeed carry unintended
    side-effects, such as information asymmetry, perceived or real
    favoritism, and, in the worst case, intentional misrepresentation of
    loan characteristics. Since trust and transparency are key values for Kiva
    &mdash; or any other finance system, for that matter &mdash;
    any potential deployment into a global production setting should only happen after careful
    analysis of the risks and benefits involved. <b>In the framework
    of this 4-week final
    project, I make no further statements about this important
    question</b>. By the way, and for the record:
    Kiva.org was not informed about this project before it was
    completed and published here.</p>

    <h3>Solution architecture</h3>

    <p>My technical solution consists of 4 main components:
      <ul>
	<li>Web services offered by <a href="http://kiva.org/" target="_">kiva.org</a>,
	for <a href="http://build.kiva.org/" target="_">offline</a> and <a href="http://build.kiva.org/api" target="_">online</a> data retrieval</li>
	<li>An offline process for training and evaluating the predictor</li>
	<li>A live predictor, deployed in the cloud</li>
	<li>A web browser (Google Chrome) with a self-developed extension that virtually integrates all
	solution elements</li>
      </ul>
    </p>

    <figure>
      <img src="/images/kiva_loan_funding_predictor_architecture.png"
      style="margin-top:20px; margin-bottom:20px;"/>
      <figcaption>Architectural overview of the end-to-end loan funding
      predictor solution</figcaption>
    </figure>

    <p>I now elaborate on each component, following
    the steps (1-6) in which they come into play. This description is somewhat
    idealistic, in that the real-life R&amp;D process was more of a
    agile and iterative nature.</p>

    <p>All code is available
    on <a href="https://github.com/fdurant/kiva_project"
    target="_">GitHub</a>. Steps 1 and 2 were run from
    an <a href="http://nbviewer.ipython.org/github/fdurant/kiva_project/blob/master/Kiva_predicting_loan_funding.ipynb"
    target="_">iPython notebook</a>.</p>

    <h2>Step 1: Data Preparation</h2>

    <table>
      <tr>
	<th>Technology</th>
	<th>Used for</th>
	<th>Useful for</th>
      </tr>
      <tr>
	<td><a href="https://www.mongodb.org/" target="_">MongoDB</a></td>
	<td>Local storage of documents/objects in the <a href="http://build.kiva.org" target="_">Kiva JSON snapshot</a></td>
	<td>Selection of loans from specific years</td>
      </tr>
      <tr>
	<td><a href="https://github.com/saffsd/langid.py" target="_">langid.py</a></td>
	<td>Language identification of Kiva loan descriptions</td>
	<td>Correcting erroneous language identification by Kiva, due
	to mixed original versions and their translations</td>
      </tr>
      <tr>
	<td><a href="http://pandas.pydata.org" target="_">Pandas</a>
	and <a href="http://www.numpy.org" target="_">numpy</a></td>
	<td>Efficient storage of (mostly numeric) data points</td>
	<td>Training and test data for supervised learning</td>
      </tr>
      <tr>
	<td><a href="http://matplotlib.org" target="_">Matplotlib</a></td>
	<td>Plotting data</td>
	<td>Producing the loan bar chart, split per gender and
	quarter (see above), and feature polarity graphs (see below)</td>
      </tr>
      <tr>
	<td><a href="https://radimrehurek.com/gensim/" target="_">gensim</a></td>
	<td>Conversion of loan descriptions to a bag-of-words
	representation</td>
	<td>Formatting these data in Blei Corpus Format, readable by
	SLDA (see below)</td>
      </tr>
      <tr>
	<td><a href="https://github.com/chbrown/slda" target="_">SLDA</a> (Supervised Latent Dirichlet Allocation)</td>
	<td>Training and evaluation of an <em>auxiliary</em> topic model</td>
	<td>Reduction of 1000-dimensional bag-of-words vectors from the
	loan descriptions to 20 features (distribution over topics)</td>
      </tr>
    </table>

    <p>In preparation of a previous project, I had already downloaded
    a Kiva snapshot of approximately 775.000 loans and their
    respective lenders on February 17,
    2015. The data are reused in this project.</p>

    <h2>Step 2: Predictor/classifier training and evaluation</h2>

    <table>
      <tr>
	<th>Technology</th>
	<th>Used for</th>
	<th>Useful for</th>
      </tr>
      <tr>
	<td><a href="http://scikit-learn.org/" target="_">Scikit-learn</a></td>
	<td>Training and evaluating a logistic regression model</td>
	<td>Producing predictions and (rankable) prediction scores
	between 0-1</td>
      </tr>
      <tr>
	<td><a href="https://docs.python.org/2/library/pickle.html" target="_">pickle</a></td>
	<td>Serialization of the trained model</td>
	<td>Deployment to the live web app</td>
      </tr>
    </table>

    <h3>Feature creation</h3>

    <p>
      Three types of input features were extracted and/or derived from the JSON snapshot:
      <ul>
	<li>19 <b>loan features</b> extracted from
	the <a href="http://api.kivaws.org/v1/loans/844974.json"
	target="_">JSON representation</a> of a <a href="http://www.kiva.org/lend/844974" target="_">Kiva loan</a></li>
	<li>20 <b>topic model features</b> inferred for each loan
	from a Supervised Latent Dirichlet
	Allocation model that I created on the side</li>
	<li>4 <b>partner features</b> extracted from the <a href="http://api.kivaws.org/v1/partners.json" target="_">JSON
	representation</a> of
	the <a href="http://api.kivaws.org/v1/partners.html" target="_">Kiva partner list</a></li>
      </ul>
    </p>

    <p>The to-be-predicted label is defined as follows: divide the actual
    &quot;funded_amount&quot; by the requested &quot;loan_amount&quot;. If this
    ratio is greater than or equal to 1, the loan is fully funded
    (<b>label 1</b>). If not, the loan is not fully funded (<b>label 0</b>).
      <ul></ul>
    </p>

    <p>The data set consists of <b>all</b> usable loans from the years 2012
    through 2014: <b>21 K negative and 420 K positive</b>
    instances. This a priori 20/1 ratio calls for
    careful <a href="http://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LogisticRegression.html"
    target="_">class weight settings</a> during 
      model training.</p>

    <h3>Model training</h3>

    <p>From the outset, it was my plan to fit
    a <a href="http://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LogisticRegression.html"
    target="_">logistic regression</a> model 
    against the training data, using 10-fold cross validation. The
    chosen <a href="http://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LogisticRegression.html"
    target="_">class weight setting is 'auto'</a>, which should compensate
    for the strong predicted label imbalance in the training set. I also included
    some experimentation with varying regularization parameters. Since
    my prime goal in this project is to <b>deliver an end-to-end
    system, rather than
    only <a href="http://www.vogue.com/1066581/supermodel-workouts-and-trainers/"
    target="_">an optimally trained &quot;supermodel&quot;</a></b>, I did not try 
    out any other algorithm here. This pragmatic choice helped us maintain
    focus throughout the project.</p>

    <figure>
      <img src="/images/optimally_trained_supermodel.jpg"/>
      <figcaption>Depiction of an optimally trained supermodel (source:
      <a href="http://www.vogue.com/1066581/supermodel-workouts-and-trainers/"
      target="_">Vogue.com</a>)</figcaption>
    </figure>

    <h3>Incremental feature contribution to model performance</h3>

    <p>As evaluation metric, I chose
    the <a href="http://en.wikipedia.org/wiki/Receiver_operating_characteristic"
    target="_">ROC</a> <a href="http://scikit-learn.org/stable/modules/generated/sklearn.metrics.roc_auc_score.html"
    target="_">area under the curve</a>. To detect the <b>most
    informative feature groups</b>, I started, in a 10-fold cross validation setting, 
      from an information-less
    baseline model with 50% ROC AUC performance. I then tested each
    of the remaining feature groups independently, selecting the best one
    as the
    &quot;constant&quot; feature group for the next round. There, it
    was on its turn combined with
    each of the remaining feature groups; again, a winner was
    selected and added to the ranked list of feature groups. The
    end result of this iterative process is the following <b>feature group ranking</b>,
    in descending order of <b>marginal contribution</b>:</p> 

    <table>
      <tr>
	<th>Type</th>
	<th>Feature group</th>
	<th>ROC AUC</th>
	<th>Percentage point improvement</th>
      </tr>
      <tr>
	<td>&mdash;</td>
	<td>Baseline</td>
	<td>50.00 &#37;</td>
	<td>&mdash;</td>
      </tr>
      <tr>
	<td>Loan</td>
	<td>Log10LoanAmount</td>
	<td>76,50 &#37;</td>
	<td>+ 26.50</td>
      </tr>
      <tr>
	<td>SDLA</td>
	<td>20 loan description topics</td>
	<td>80.72 &#37;</td>
	<td>+ 4.22</td>
      </tr>
      <tr>
	<td>Loan</td>
	<td>PostedMonth[Jan..Dec]</td>
	<td>83.55 &#37;</td>
	<td>+ 2.83</td>
      </tr>
      <tr>
	<td>Loan</td>
	<td>MajorityGender</td>
	<td>85.99 &#37;</td>
	<td>+ 2.44</td>
      </tr>
      <tr>
	<td>Loan</td>
	<td>Log10NumberOfBorrowers</td>
	<td>87.13 &#37;</td>
	<td>+ 1.14</td>
      </tr>
      <tr>
	<td>Partner</td>
	<td>LoansPosted &amp; TotalAmountRaised</td>
	<td>87.42 &#37;</td>
	<td>+ 0.29</td>
      </tr>
      <tr>
	<td>Loan</td>
	<td>GeoLongitude &amp; GeoLatitude</td>
	<td>87.63 &#37;</td>
	<td>+ 0.21</td>
      </tr>
      <tr>
	<td>Loan</td>
	<td>RepaymentTerm</td>
	<td>87.77 &#37;</td>
	<td>+ 0.14</td>
      </tr>
      <tr>
	<td>Partner</td>
	<td>DelinquencyRate &amp; Rating</td>
	<td>87.77 &#37;</td>
	<td>+ 0.00</td>
      </tr>
      <tr>
	<td>Loan</td>
	<td>BonusCreditElegibility</td>
	<td>87.82 &#37;</td>
	<td>+ 0.05</td>
      </tr>
    </table>

    <p>A few observations:
      <ul>
	<li>The mere combination of the <b>four best feature groups</b>
	already achieves <b>85.99%</b> of ROC AUC. The additional six feature
	groups add less than 3 percentage points.</li>
	<li>Given the abovementioned difference between male and
	female borrowers, we expected <b>gender of the borrower</b>
	&mdash; or, more generally and precisely,
	of the <em>majority</em> of borrowers &mdash; to be among the most
	informative features. This is confirmed, but it is somewhat surprising
	that the <b>20-dimensional semantic contents of the loan
	description</b> is even more informative. A plausible
	explanation is that <b>gender is partially encoded in various implicit
	and explicit ways in the loan description</b>. Check for yourself,
	as an example, in
	this <a href="http://www.kiva.org/lend/844974"
	target="_">female</a>
	and <a href="http://www.kiva.org/lend/844974"
	target="_">male</a> loan description for explicit
	gender-specific clues like pronouns. The implicit ones may be
	hidden inside particular types of gender-specific activities
	or textual clues (not further
	mined in this project).</li>
	<li>The <b>month</b> in which a loan request is posted is also highly
	informative. This was already apparent from the histogram
	above, where the second and third quarter of each year
	show a spike in loan requests, which has an impact on the
	backfill ratio.</li>
      </ul>
    </p>

    <p>Also of interest is the feature polarity, i.e. whether a feature
    influences a positive prediction (= full funding) in the positive
    or negative sense. Let's look successively at the 
    &quot;PostedMonth&quot; features, the topic features, and all the
    other ones.</p>

    <h3>What is the optimal time of year to post a loan?</h3>

    <p>All other things being equal, it is easier to get loans fully funded that are posted in the <b>first
    three months</b> of the calendar year. September and June are the least
    advantageous.</p>

    <figure>
      <img src="/images/LogRes_Model_Coefficients_Months.png"/>
      <figcaption>Overview of PostedMonth[Jan..Dec] features with their
      respective logistic regression model coefficients, ranked from
      left to right in descending order</figcaption>
    </figure>

    <h3>What is the impact of the topics found in the loan descriptions?</h3>

    <p>Twelve topics contribute positively towards full funding, the
    remaining eight negatively. The extent to which a <b><a href="http://www.kiva.org/lend/844974" target="_">specific
    loan description</a></b> contributes in either direction, of course
    also depends of
    on the actual <b>distribution of topics</b> found in that
    particular document.</p>

    <figure>
      <img src="/images/LogRes_Model_Coefficients_Topics.png"/>
      <figcaption>Overview of 20 topic features with their
      respective logistic regression model coefficients, ranked from
      left to right in descending order &mdash;
      [<a href="/images/LogRes_Model_Coefficients_Topics.png"
      target="_">for better viewing, click here to open the graph in a
      separate window</a>]</figcaption>
    </figure>

    <p>Each topic is represented here by its ten most prominent words.</p>

    <h3>And what about the other features?</h3>

    <p>A <b>positive</b> contributor to full funding is the <b>total amount of
    money raised by the field partner</b>: this can be interpreted as a proxy
      for the partner's longevity and reliability. On the other hand,
    the <b>number of loans</b> (LoansPosted)
    that went through that same field partner's hands <b>negatively</b>
    impacts full funding - strangely so.</p>

    <p><b>The more borrowers</b> take part in a loan request, <b>the better its
    chanches</b> to get fully funded. This can be interpreted as a form
    of risk reduction, the idea being that multiple borrowers
    will help and/or control each other, thereby increasing loan
    quality. Otherwise said: lenders tend to appreciate and foster collaboration
    between borrowers - with their money.</p>

    <figure>
      <img src="/images/LogRes_Model_Coefficients_Other_Features.png"/>
      <figcaption>Overview of the remaining features with their
      respective logistic regression model coefficients, ranked from
      left to right in descending order</figcaption>
    </figure>

    <p>In my system, gender is encoded as female=0, and male=1. The
    negative impact of the MajorityGender feature therefore confirms
    the initial hypothesis that <b>male borrowers have a harder time
    getting their predisbursed loan requests backfilled</b>.</p>

    <p>The feature with the <b>most important negative impact</b> across the
    whole feature set (<em>including</em> PostedMonth and topic features) is
    the loan amount: <b>the more money is requested, the harder it
    is to get the loan fully funded</b>. Assuming a constant allocatable
    sum per lender at a particular moment in time, it is logical that
    more lenders are required then to backfill a larger loan amount. If
    not enough lenders are found within the expiration period, the loan does
    not get fully funded.</p>

    <h3>Code organization for easy deployment</h3>

    <p>In order to facilitate deployment of the model in a live
    setting, and maximize code reuse, all
    relevant data preprocessing, feature creation (especially for SLDA),
    and feature scaling functionality was cleanly implemented in separate Python modules:
      <ul>
	<li><a href="https://github.com/fdurant/kiva_project/blob/master/src/SldaTextFeatureGenerator.py" target="_">SldaTextFeatureGenerator</a></li>
	<li><a href="https://github.com/fdurant/kiva_project/blob/master/src/KivaLoan.py" target="_">KivaLoan</a></li>
	<li><a href="https://github.com/fdurant/kiva_project/blob/master/src/KivaLoans.py" target="_">KivaLoans</a></li>
	<li><a href="https://github.com/fdurant/kiva_project/blob/master/src/KivaPartner.py" target="_">KivaPartner</a></li>
	<li><a href="https://github.com/fdurant/kiva_project/blob/master/src/KivaPartners.py" target="_">KivaPartners</a></li>
	<li><a href="https://github.com/fdurant/kiva_project/blob/master/src/KivaLoanFundingPredictor.py" target="_">KivaLoanFundingPredictor</a></li>
      </ul>
    </p>

    <p>
      Finally, the best performing model
      was <a href="https://docs.python.org/2/library/pickle.html" target="_">pickled</a> and <a href="https://github.com/fdurant/kiva_project/blob/master/data/predicting_funding/logres_out/kivaLoanFundingPredictor.pkl"
      target="_">stored in GitHub</a>.
      The main script that runs model training and evaluation is
      <a href="https://github.com/fdurant/kiva_project/blob/master/src/loan_funding_predictor.py"
      target="_">loan_funding_predictor.py</a>. See the <a href="http://nbviewer.ipython.org/github/fdurant/kiva_project/blob/master/Kiva_predicting_loan_funding.ipynb" target="_">iPython notebook</a> for its usage.
    </p>

    <h2>Step 3: Deployment of the predictor to the live back-end</h2>

    <table>
      <tr>
	<th>Technology</th>
	<th>Used for</th>
	<th>Useful for</th>
      </tr>
      <tr>
	<td><a href="https://github.com/fdurant/kiva_project/tree/master/data/predicting_funding/logres_out" target="_">GitHub</a></td>
	<td>Storage of the best performing model</td>
	<td>Lightweight deployment to the (until further notice transient) cloud environment</td>
      </tr>
      <tr>
	<td><a href="https://docs.python.org/2/library/pickle.html" target="_">pickle</a></td>
	<td>Deserialization of the trained model</td>
	<td>Loading the trained model in the live web app</td>
      </tr>
      <tr>
	<td><a href="https://github.com/chbrown/slda" target="_">SLDA</a> (Supervised Latent Dirichlet Allocation)</td>
	<td>Inference of gamma values against a pre-trained auxiliary
	topic model</td>
	<td>On-the-fly feature generation for previously unseen loan descriptions</td>
      </tr>
      <tr>
	<td><a href="http://flask.pocoo.org/" target="_">Flask</a>
	and <a href="https://flask-restful.readthedocs.org/" target="_">Flask-RESTful</a></td>
	<td>Setup of live RESTful web application</td>
	<td>Serving on-the-fly predictions for previously unseen Kiva loan requests</td>
      </tr>
    </table>

    <p>Deployment of the software and prediction model to the virtual machine
      at <a href="https://www.digitalocean.com" target="_">Digital Ocean</a>
      was simply done by logging onto that machine, and pulling all
      relevant files from GitHub. The trained model itself
      was <a href="https://docs.python.org/2/library/pickle.html"
      target="_">unpickled</a> and loaded into
      a <a href="https://github.com/fdurant/kiva_project/blob/master/src/predictLoanFundingWebApp.py"
      target="_">Flask-based web application</a>. Obviously, the
      virtual box also includes preinstalled copies of Python, all
      required libraries
      (including <a href="https://github.com/fdurant/kiva_project/blob/master/src/predictLoanFundingWebApp.py"
      target="_">sklearn</a>), and a precompiled <a href="https://github.com/chbrown/slda" target="_">slda</a> binary.</p>

    <h2>Step 4: Getting a loan page from Kiva</h2>

    <p>This step is simply a retrieval of a
    new <a href="http://www.kiva.org/lend/844974" target="_">loan page
    from the Kiva website</a>. Kiva offers its lenders a constant stream
    of <a href="http://www.kiva.org/browse" target="_">recently
    predisbursed loan requests</a> from which to choose.</p>

    <p>The following steps describe how we can &mdash; at least
    virtually &mdash; <b>augment each loan page with live information
    from the loan funding predictor</b>.</p>

    <h2>Step 5: Getting a prediction from the live back-end</h2>

    <p>
      <b>Disclaimer</b>: at the time of writing, and until further
      notice, the live environment is not 
      meant to be running permanently. The backend will only be live
      during planned demonstrations.
    </p>

    <p>A typical backend request-response cycle looks like this:</p>

    <figure>
      <img src="/images/loan_funding_prediction_REST_request_response.png"
      style="border-style:solid;border-width:1px;"/>
      <figcaption>Example request and JSON response of the live
      predictor, with highlighted fields (blue) and topic gamma
      values (orange)</figcaption>
    </figure>

    <p>Each loan funding prediction response returns:
    <ul>
      <li>the <b>prediction</b>: 0 (not fully funded) or 1 (fully funded)</li>
      <li>the <b>loan funding score</b>: a floating point number between 0 and 1</li>
      <li>the <b>topic scores</b>: a list of 20 topics for the loan
	description at hand, ranked by descending
	<a href="https://www.cs.princeton.edu/~blei/papers/BleiMcAuliffe2007.pdf"
	target="_">gamma value</a> (prominence).</li>
    </ul>
    </p>
    <p>
	Again, each topic is
	represented by its 10 most prominent words. In isolation, the gamma values say
	nothing about the propensity of a given loan to get funded or not.
	As explained earlier, the polarity or direction of the
	relationship between each topic and the class label is
	captured in the logistic regression model. At prediction time,
	the loan document's
	gamma values serve as input to the logistic
	regression model.
	This prediction happens together with all the other features in one go,
	of course.</p>

    <h2>Step 6: Getting Kiva's information on a new loan</h2>

    <p>Before the predictor could send the abovementioned response, it
    obviously needed some loan information to work on. In the current
    architecture, the predictor web 
    application
    itself <a href="http://api.kivaws.org/v1/loans/844974.json"
    target="_">reaches out to the Kiva REST API</a>, to get all
    relevant loan information on the fly.</p>

    <h2>Step 4 revisited: visual integration in Google Chrome</h2>

    <table>
      <tr>
	<th>Technology</th>
	<th>Used for</th>
	<th>Useful for</th>
      </tr>
      <tr>
	<td>Kango<a href="http://kangoextensions.com/" target="_"></a></td>
	<td>Creating a Google Chrome browser extension</td>
	<td>Virtual integration of the loan prediction info into a
	Kiva loan web page</td>
      </tr>
      <tr>
	<td>jQuery<a href="http://jquery.com" target="_"></a></td>
	<td>Faster JavaScript development</td>
	<td>Creating two DOM elements that display loan funding
	information on a Kiva loan web page</td>
      </tr>
    </table>
    
    <p>To dynamically integrate the information received in step 5, I
    wrote
    a Google Chrome extension based
    on <a href="http://kangoextensions.com/ "
    target="_">Kango</a> and <a href="https://jquery.com/"
    target="_">jQuery</a>. Once it is <a href="https://support.google.com/chrome_webstore/answer/2664769?hl=en">installed</a>
    and <a href="https://support.google.com/chrome/answer/167997?hl=en">activated</a>,
    the <a href="kivaloanfundingvisualization_0.1.0_chrome_webstore.zip"
    target="_">Kiva Loan Funding Visualization</a> extension displays two
    new boxes inside any Kiva Loan page visited from that
    browser. It then looks like this:</p>

    <figure>
      <img src="/images/kiva_loan_page_with_augmented_prediction_info.png"
      style="border-style:solid;border-width:1px;"/>
      <figcaption>Augmented Kiva loan web page, containing two extra blue
      boxes with on the fly predicted info</figcaption>
    </figure>    

    <p>The box in the upper-right corner contains the prediction
    score expressed as a (rounded) percentage, and a thumbs up/down image that
    represents the binary prediction. The treshold is currently set
    at 50%. The probability is called a priori, to stress that
    the <em>actual</em> funding status (displayed by Kiva) does not play any role in
    the predicted value. In other words, the predictor would predict the same
    probability before, during or after the funding period - with one
    exception: the field partner features (e.g. LoansPosted), may have changed over time.</p>
   
    <p>The box below the borrower's image contains the three most
    prominent topics for the loan (description) at hand.</p>

    <h2>Conclusion and further work</h2>

    <p>In this project, I have developed an end-to-end system that enables multiple
    actors in the Kiva ecosystem to get an a priori insight into the
    funding chances of previously unseen loans. While the current
    logistic regression model can no doubt be improved in various
    ways, its current  performance of 87.82% ROC Area Under Curve is
    sufficient for a proof of concept.</p>

      <p>As the virtual
    integration through a browser extension demonstrates, the system can
    indeed be deployed with minimum extra engineering effort, should
    Kiva wish to do so.</p>

    <p> At the same time,
    the positive or negative contribution of each feature was
    identified. This may help Kiva actors in the field to adapt certain
    behaviours or revise certain decision strategies, should they feel
    the need to do so.</p>

    <p>As far as deployment in the Kiva ecosystem is concerned, then, there
      will be <b>more strategic and ethical questions to be answered,
      than technical ones</b>.</p>

    <p>Potential avenues for model performance improvement include:
      <ul>
	<li>A more refined and tuned Supervised Latent Dirichlet Allocation model</li>
	<li>Different logistic regression settings</li>
	<li>Alternative estimators</li>
	<li>Additional and/or better features. I am especially interested in
	adding &quot;trust&quot; features detected from the borrower's
	  image. The reason is simple: when I made my first Kiva loan
	in February, the image contents played a major role in my own
	  choice.</li>
      </ul>
    </p>

    <h2><a name="kiva_research">Research papers on Kiva</a></h2>

    <p>
      <ul>
	<li>[<a name="#jenq">1</a>] Christina Jenq, Jessica Pan and Walter Theseira: <a href="http://riped.utcc.ac.th/wp-content/uploads/2012/03/Dr_Jessica_Pan_30_March_2012.pdf" target="_">What Do Donors Discriminate On? Evidence from Kiva.org</a></li>
	<li>[<a name="Choo_Lee_Lee_Zha_Park">2</a>]Jaegul Choo,
	Changhyun Lee, Daniel Lee, Hongyuan Zha and Haesun Park:
	<a href="http://www.cc.gatech.edu/~joyfull/resources/2014_wsdm_kiva.pdf"
	target="_">Understanding and Promoting Micro-Finance Activities in Kiva.org</a></li>
      </ul>
    </p>

    <h2>Acknowledgements</h2>

    <p>Having come at the end of this bootcamp in New York City, I would like to thank:
      <ul>
	<li>my
    instructors <a href="https://www.linkedin.com/pub/irmak-sirer/2a/752/846"
    target="_">Irmak
    Sirer</a>, <a href="https://www.linkedin.com/profile/view?id=92036474"
    target="_">Bo
    Peng</a> and <a href="https://www.linkedin.com/in/ajschumacher"
    target="_">Aaron Schumacher</a> for having turned this Data
    Science Bootcamp into such an pleasant and rewarding
    experience. You guys rock!</li>
	<li>my <a href="https://krash.io/" target="_">Krash Brooklyn</a> housemate and PhD
	candidate <a href="https://www.linkedin.com/in/mgerritzen" target="_">Marc Gerritzen</a> for
	his valuable comments on an earlier version of this blog
	post, and, more generally, his interest in this project.</li>
	<li>all my fellow <a href="http://www.thisismetis.com/ds-alumni" target="_">Metis Data Science students (Winter Cohort
	2015)</a>, and my fellow <a href="https://krash.io/" target="_">Krashers in Brooklyn</a>.</li>
	<li>my family and friends at home, for putting up with my three-month absence.</li>
	<li>the amazing and awesome city and people of New York, for
	their inspiration and energy.</li>
      </ul>
    </p>

  </body>
</html>
